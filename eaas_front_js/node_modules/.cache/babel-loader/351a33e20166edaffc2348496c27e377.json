{"ast":null,"code":"import agent from './agent';\nimport { ASYNC_START, ASYNC_END, LOGIN, LOGOUT, REGISTER } from './constants/actionTypes';\n\nconst promiseMiddleware = store => next => action => {\n  if (isPromise(action.payload)) {\n    store.dispatch({\n      type: ASYNC_START,\n      subtype: action.type\n    });\n    const currentView = store.getState().viewChangeCounter;\n    const skipTracking = action.skipTracking;\n    action.payload.then(res => {\n      const currentState = store.getState();\n\n      if (!skipTracking && currentState.viewChangeCounter !== currentView) {\n        return;\n      }\n\n      console.log('RESULT', res);\n      action.payload = res;\n      store.dispatch({\n        type: ASYNC_END,\n        promise: action.payload\n      });\n      store.dispatch(action);\n    }, error => {\n      const currentState = store.getState();\n\n      if (!skipTracking && currentState.viewChangeCounter !== currentView) {\n        return;\n      }\n\n      console.log('ERROR', error);\n      action.error = true;\n      action.payload = error.response && error.response.body;\n\n      if (!action.skipTracking) {\n        store.dispatch({\n          type: ASYNC_END,\n          promise: action.payload\n        });\n      }\n\n      store.dispatch(action);\n    });\n    return;\n  }\n\n  next(action);\n};\n\nconst localStorageMiddleware = store => next => action => {\n  if (action.type === REGISTER || action.type === LOGIN) {\n    if (!action.error) {\n      window.localStorage.setItem('jwt', action.payload.user.token);\n      agent.setToken(action.payload.user.token);\n    }\n  } else if (action.type === LOGOUT) {\n    window.localStorage.setItem('jwt', '');\n    agent.setToken(null);\n  }\n\n  next(action);\n};\n\nfunction isPromise(v) {\n  return v && typeof v.then === 'function';\n}\n\nexport { promiseMiddleware, localStorageMiddleware };","map":{"version":3,"sources":["/Users/albertgine/Desktop/eaas_front-master/src/middleware.js"],"names":["agent","ASYNC_START","ASYNC_END","LOGIN","LOGOUT","REGISTER","promiseMiddleware","store","next","action","isPromise","payload","dispatch","type","subtype","currentView","getState","viewChangeCounter","skipTracking","then","res","currentState","console","log","promise","error","response","body","localStorageMiddleware","window","localStorage","setItem","user","token","setToken","v"],"mappings":"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","sourcesContent":["import agent from './agent';\nimport {\n    ASYNC_START,\n    ASYNC_END,\n    LOGIN,\n    LOGOUT,\n    REGISTER\n} from './constants/actionTypes';\n\nconst promiseMiddleware = store => next => action => {\n    if (isPromise(action.payload)) {\n        store.dispatch({ type: ASYNC_START, subtype: action.type });\n\n        const currentView = store.getState().viewChangeCounter;\n        const skipTracking = action.skipTracking;\n\n        action.payload.then(\n            res => {\n                const currentState = store.getState()\n                if (!skipTracking && currentState.viewChangeCounter !== currentView) {\n                    return\n                }\n                console.log('RESULT', res);\n                action.payload = res;\n                store.dispatch({ type: ASYNC_END, promise: action.payload });\n                store.dispatch(action);\n            },\n            error => {\n                const currentState = store.getState()\n                if (!skipTracking && currentState.viewChangeCounter !== currentView) {\n                    return\n                }\n                console.log('ERROR', error);\n                action.error = true;\n                action.payload = error.response && error.response.body;\n                if (!action.skipTracking) {\n                    store.dispatch({ type: ASYNC_END, promise: action.payload });\n                }\n                store.dispatch(action);\n            }\n        );\n\n        return;\n    }\n\n    next(action);\n};\n\nconst localStorageMiddleware = store => next => action => {\n    if (action.type === REGISTER || action.type === LOGIN) {\n        if (!action.error) {\n            window.localStorage.setItem('jwt', action.payload.user.token);\n            agent.setToken(action.payload.user.token);\n        }\n    } else if (action.type === LOGOUT) {\n        window.localStorage.setItem('jwt', '');\n        agent.setToken(null);\n    }\n\n    next(action);\n};\n\nfunction isPromise(v) {\n    return v && typeof v.then === 'function';\n}\n\n\nexport { promiseMiddleware, localStorageMiddleware }"]},"metadata":{},"sourceType":"module"}